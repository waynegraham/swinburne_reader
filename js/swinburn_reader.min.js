/*! swinburn_reader 29-05-2015 */
!function(a){"use strict";function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a,c){this.el=a,this.options=b({},this.options),b(this.options,c),this._init()}var d=(a.document.documentElement,{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}),e=d[Modernizr.prefixed("transition")],f={transitions:Modernizr.csstransitions};c.prototype.options={perspective:"1200",slideshowRatio:.3,onToggle:function(){return!1},onToggleContent:function(){return!1},onToggleContentComplete:function(){return!1}},c.prototype._init=function(){var a=this;this.current=0,this.isFullscreen=!0,this.imgDragger=this.el.querySelector("section.dragdealer"),this.handle=this.imgDragger.querySelector("div.handle"),this.slides=[].slice.call(this.handle.children),this.slidesCount=this.slides.length,this.slidesCount<1||(this.slideshowRatio=this.options.slideshowRatio,classie.add(this.slides[this.current],"current"),this.pages=this.el.querySelector("section.pages"),this.handle.style.width=100*this.slidesCount+"%",this.slides.forEach(function(b){b.style.width=100/a.slidesCount+"%"}),this._initDragDealer(),this.el.style.WebkitPerspective=this.options.perspective+"px",this.el.style.perspective=this.options.perspective+"px",this._initEvents())},c.prototype._initEvents=function(){var a=this;this.slides.forEach(function(b){b.addEventListener("click",function(){return a.isFullscreen||a.dd.activity||a.isAnimating?!1:void(a.slides.indexOf(b)===a.current?a.toggle():a.dd.setStep(a.slides.indexOf(b)+1))}),b.querySelector("button.content-switch").addEventListener("click",function(){a._toggleContent(b)})}),document.addEventListener("keydown",function(b){var c=b.keyCode||b.which,d=a.slides[a.current];if(a.isContent)switch(c){case 38:0===a._getContentPage(d).scrollTop&&a._toggleContent(d)}else switch(c){case 40:if(!a.isFullscreen)return;a._toggleContent(d);break;case 37:a.dd.setStep(a.current);break;case 39:a.dd.setStep(a.current+2)}})},c.prototype._getContentPage=function(a){return this.pages.querySelector('div.content[data-content = "'+a.getAttribute("data-content")+'"]')},c.prototype._toggleContent=function(a){if(this.isAnimating)return!1;this.isAnimating=!0,this.options.onToggleContent();var b=this._getContentPage(a);this.isContent?(this.dd.enable(),classie.remove(this.el,"show-content")):(b.scrollTop=0,this.dd.disable(),classie.add(this.el,"show-content"),classie.add(b,"show"));var c=this,d=function(a){if(f.transitions){if(-1===a.propertyName.indexOf("transform")||a.target!==this)return;this.removeEventListener(e,d)}c.isContent&&classie.remove(b,"show"),c.isContent=!c.isContent,c.isAnimating=!1,c.options.onToggleContentComplete()};f.transitions?this.el.addEventListener(e,d):d()},c.prototype._initDragDealer=function(){var a=this;this.dd=new Dragdealer(this.imgDragger,{steps:this.slidesCount,speed:.4,loose:!0,requestAnimationFrame:!0,callback:function(b,c){a._navigate(b,c)}})},c.prototype._navigate=function(){classie.remove(this.slides[this.current||0],"current"),this.current=this.dd.getStep()[0]-1,classie.add(this.slides[this.current],"current")},c.prototype.toggle=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._preserve3dSlides(!0),this.options.onToggle(),classie.remove(this.el,this.isFullscreen?"switch-max":"switch-min"),classie.add(this.el,this.isFullscreen?"switch-min":"switch-max");var a=this,b=this.options.perspective,c=this.options.slideshowRatio,d=this.isFullscreen?b-b/c:b-b*c;this.imgDragger.style.WebkitTransform="translate3d( -50%, -50%, "+d+"px )",this.imgDragger.style.transform="translate3d( -50%, -50%, "+d+"px )";var g=function(b){if(f.transitions){if(-1===b.propertyName.indexOf("transform"))return;this.removeEventListener(e,g)}a.isFullscreen||a._preserve3dSlides(),classie.remove(this,a.isFullscreen?"img-dragger-large":"img-dragger-small"),classie.add(this,a.isFullscreen?"img-dragger-small":"img-dragger-large"),a.imgDragger.style.WebkitTransform="translate3d( -50%, -50%, 0px )",a.imgDragger.style.transform="translate3d( -50%, -50%, 0px )",this.style.width=a.isFullscreen?100*a.options.slideshowRatio+"%":"100%",this.style.height=a.isFullscreen?100*a.options.slideshowRatio+"%":"100%",a.dd.reflow(),a.isFullscreen=!a.isFullscreen,a.isAnimating=!1};f.transitions?this.imgDragger.addEventListener(e,g):g()},c.prototype._preserve3dSlides=function(a){this.slides.forEach(function(b){b.style.transformStyle=a?"preserve-3d":""})},a.DragSlideshow=c}(window);